---
import BaseLayout from "@/layouts/BaseLayout.astro";
import RichContent from "@/components/RichContent.astro";
import properties from "@/data/properties";
import { formatPrice } from "@/utils/formatters";

export async function getStaticPaths() {
  const LANGS = ["es", "en", "de", "fr", "it", "nl"];

  return properties.flatMap((property) =>
    LANGS.map((lang) => ({
      params: {
        lang,
        slug: property.slugs[lang],
      },
    }))
  );
}

const { lang, slug } = Astro.params;

const property = properties.find(
  (p) => p.slugs[lang] === slug
);

if (!property) {
  throw new Error(`Property not found: ${lang}/${slug}`);
}

const t = property.translations[lang];
const p = property.property;
---

<BaseLayout title={`${t.title} | BlancaReal`} lang={lang}>
  <article>
    <h1>{t.title}</h1>

    {property.price && (
      <p>
        <strong>Precio:</strong>{" "}
        {formatPrice(property.price, property.currency, lang)}
      </p>
    )}

    <p>
      <strong>Ubicación:</strong>{" "}
      {property.location.area}, {property.location.province}
    </p>

    <p>
      <strong>Tipo:</strong> {p.type}
    </p>

    <ul>
      {p.bedrooms && <li><strong>Dormitorios:</strong> {p.bedrooms}</li>}
      {p.bathrooms && <li><strong>Baños:</strong> {p.bathrooms}</li>}
      {p.garages && <li><strong>Garaje:</strong> {p.garages}</li>}
      {p.area_m2 && <li><strong>Construidos:</strong> {p.area_m2} m²</li>}
      {"usable_area_m2" in p && p.usable_area_m2 && (
        <li>
          <strong>Útiles:</strong> {p.usable_area_m2} m²
        </li>
      )}
      {p.terrace_m2 && <li><strong>Terrazas:</strong> {p.terrace_m2} m²</li>}
      {p.garden_m2 && <li><strong>Jardín:</strong> {p.garden_m2} m²</li>}
      {p.orientation && <li><strong>Orientación:</strong> {p.orientation}</li>}
    </ul>

    <hr />

    <RichContent blocks={t.description} />
  </article>
</BaseLayout>
